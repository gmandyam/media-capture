<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' lang='en'>
  <head>
    <meta charset='utf-8'/>
    <title>Picture Settings</title>
    <script class='remove'>
      var respecConfig = {
          specStatus: "Member-SUBM"
      ,   shortName:  "picture-settings"
      ,   editors: [
         {   name:       "Giridhar Mandyam"
                ,   company:    "Qualcomm Innovation Center, Inc"
                ,   companyURL: "http://www.qualcomm.com/about/businesses/quicinc" }
          ]
      ,   edDraftURI:   "http://gmandyam.github.com/media-capture"
      ,   copyrightStart: 2012
      ,   noIDLIn:      true
      ,   wg:           "Media Capture Task Force"
      ,   wgURI:        "http://www.w3.org/wiki/Media_Capture"
      ,   wgPublicList: "public-media-capture"
      ,   wgPatentURI:  "XXX"
      ,   isRecTrack:   false
      ,   isNoTrack:    true
      ,   format:       'markdown'
      };
    </script>
    <script src='./respec-w3c-common-markdown-alpha.js' class='remove' async></script>
  </head>
  <body>
    <section id='sotd'>
      Comments on this document are welcomed.
    </section>
    
    <section id='abstract'>
      This document specific settings for a takePicture() method to be defined as part of the Media Capture specification.
    </section>
    
    Introduction
    ------------
    <p>Various proposals have been provided to the Task Force regarding methods for taking a picture that can extend getUserMedia().
    This proposal focused on picture settings that are compatible with the cameras associated with many handheld devices.  It leverages the takePicture() method
    as described in <a href=http://dvcs.w3.org/hg/dap/raw-file/tip/media-stream-capture/proposals/SettingsAPI_proposal_v4.html>Settings API Version 4</a>. </p>
    
    <p>The takePicture() method is currently defined on a a PictureDeviceTrack according to
    the cited proposal as follows:</p>
    
    <dl title='interface PictureDeviceTrack : VideoStreamTrack' class='idl'>
    <dt>void takePicture ()</dt>
    <dd>Temporarily mutes the owning VideoDeviceTrack's stream, then asynchronously switches the camera into "high resolution picture mode", applies the PictureDeviceTrack settings (a snapshot from the time the takePicture API was called, and records/encodes an image using a user-agent determined format into a Blob object. Finally, queues a task to fire a "picture" event with the resulting Blob instance.</dd>
    <dt>attribute EventHandler onpicture</dt>
    <dd>Register/unregister for "picture" events. The handler should expect to get a PictureEvent object as its first parameter.</dd>
    </dl>
    
    <p>For the purposes of this proposal, the main focus is on the <code>PictureDeviceTrack</code> object and <code>takePicture()</code> method.  In addition, the <code>MediaSettingsRange</code> is leveraged.
    </p>
    
    <code>MediaSettingsRange</code>
    -----------------
    <dl title='interface MediaSettingsRange' class='idl'>
    <dt>readonly attribute any max</dt>
    <dd>The maximum value of this setting</dd>
    <dt>readonly attribute any min</dt>
    <dd>The minimum value of this setting</dd>
    <dt>readonly attribute any initial</dt>
    <dd>The initial value of this setting</dd>
    <dt>void request (any value, optional boolean mandatory)</dt>
    <dd>Creates an internal constraint based on the setting name with the provided value, adds that constraint into the pending constraint structure (to the MediaTrackConstraint array by default or replaces an entry in the MediaTrackConstraintSet if the mandatory flag is set) and queues a task (if not already queued) to process the pending constraint structure at the conclusion of this task.</dd>
    </dl>
    
    <code>MediaSettingsItem</code>
    -----------------
    <p>The <code>MediaSettingsItem</code> interface is now defined, which allows for a single setting to be managed.</p>
    <dl title='interface MediaSettingsItem' class='idl'>
    <dt>readonly attribute any value</dt>
    <dd>Value of current setting.</dd>
    <dt>readonly attribute any initial</dt>
    <dd>The initial value of this setting</dd>
    <dt>void request (any value, optional boolean mandatory)</dt>
    <dd>Creates an internal constraint based on the setting name with the provided value, adds that constraint into the pending constraint structure (to the MediaTrackConstraint array by default or replaces an entry in the MediaTrackConstraintSet if the mandatory flag is set) and queues a task (if not already queued) to process the pending constraint structure at the conclusion of this task.</dd>
    </dl>
    <p></p>
    
    <code>PictureSettings</code>
    ---------------
    <p>A new object  PictureSettings is defined to control the settings for takePicture().  <code>PictureDeviceTrack</code> implements <code>PictureSettings.</code></p>
    <p>The PictureSettings interface must be supported by the User Agent.  However, any settings in this object
    that are not supported by the User Agent or selected camera may be ignored.</p>
    <dl title='interface PictureSettings' class='idl'>
    <dt>attribute MediaSettingsItem whiteBalanceMode</dt>
    <dd>This feature control the white balance mode setting. Values are of type <code>WhiteBalanceModeEnum</code>.</dd>
    <dt>attribute MediaSettingsItem autoExposureMode</dt>
    <dd>This feature control the auto exposure mode setting.  Values are of type <code>ExposureModeEnum</code>.</dd>
    <dt>attribute MediaSettingsRange exposureCompensation</dt>
    <dt>attribute MediaSettingsItem iso</dt>
    <dd>This feature control the camera ISO setting.  Values are of type <code>ISOModeEnum</code>.</dd>
    <dd> This feature changes the exposure level for recorded images. Values are numeric.</dd>
    <dt>attribute MediaSettingsItem redEyeReduction</dt>
    <dd> This feature turns on or off the camera red eye reduction and is boolean - on is true</dd>
    <dt>attribute MediaSettingsRange brightness</dt>
    <dd>This feature controls the brightness setting of the camera. Values are numeric.</dd>
    <dt>attribute MediaSettingsRange constrast</dt>
    <dd>This feature controls the contrast setting of the camera. Values are numeric.</dd>
    <dt>attribute MediaSettingsRange saturation</dt>
    <dd>This feature controls the saturation setting of the camera. Values are numeric.</dd>
    <dt>attribute MediaSettingsRange sharpness</dt>
    <dd>This feature controls the sharpness setting of the camera. Values are numeric.</dd>
    </dl>
    <p></p>
    
    #####<code>WhiteBalanceModeEnum</code>
    
    <dl title='enum WhiteBalanceModeEnum' class='idl'>
    <dt>auto</dt>
    <dd>auto</dd>
    <dt>incandescent</dt>
    <dd>2500-3500 Kelvin</dd>
    <dt>fluorescent</dt>
    <dd>4000-5000 Kelvin</dd>
    <dt>warm-fluorescent</dt>
    <dd>5000-5500 Kelvin</dd>
    <dt>daylight</dt>
    <dd>5000-6500 Kelvin</dd>
    <dt>cloudy-daylight</dt>
    <dd>6500-8000 Kelvin</dd>
    <dt>twilight</dt>
    <dd>8000-9000 Kelvin</dd>
    <dt>shade</dt>
    <dd>9000-10000 Kelvin</dd>
    </dl>
    <p></p>
    
    #####<code>ExposureModeEnum</code>
    
    <dl title='enum ExposureModeEnum' class='idl'>
    <dt>frame-average</dt>
    <dd>Average of light information from entire scene</dd>
    <dt>center-weighted</dt>
    <dd>Sensitivity concentrated towards center of viewfinder</dd>
    <dt>spot-metering</dt>
    <dd>Spot-centered weighting</dd>
    </dl>
    <p></p>
    
    #####<code>ISOModeEnum</code>
    
    <dl title='enum ISOModeEnum' class='idl'>
    <dt>auto</dt>
    <dd>Automatic adjustment</dd>
    <dt>100</dt>
    <dd>100 ASA rating</dd>
    <dt>200</dt>
    <dd>200 ASA rating</dd>
    <dt>400</dt>
    <dd>400 ASA rating</dd>
    <dt>800</dt>
    <dd>800 ASA rating</dd>
    <dt>1250</dt>
    <dd>1250 ASA rating</dd>
    </dl>
    <p></p>
    
    Example: Taking a picture after turning on Red Eye Reduction
    -------
    <pre class='example'>
    navigator.getUserMedia({video: true}, gotMedia, failedToGetMedia);
    
    function gotMedia(mediastream) {
       var videoDevice = mediastream.videoTracks[0];
       // Check if this device supports a picture mode...
       var pictureDevice = videoDevice.pictureTrack;
       if (pictureDevice) {
             pictureDevice.onpicture = showPicture;
             if (pictureDevice.redEyeReduction) {
                pictureDevice.redEyeReduction.request(true,true);
                }
             else
                console.log('No red eye reduction');
             pictureDevice.takePicture();
             }
           }

    function showPicture(e) {
           var img = document.querySelector("img");
           img.src = URL.createObjectURL(e.data);
           }
           
    function failedToGetMedia{
       console.log('Stream failure');
       }
    </pre>
  </body>
</html>
